<%- layout('./layouts/boilerplate.ejs') %>

<style>
    /* ================= HELPER TEXT ================= */
    .helper-text {
        font-size: 0.85rem;
        color: #6c757d;
    }

    /* ================= LOADING OVERLAY ================= */
    #loadingOverlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.9);
        z-index: 9999;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    }
</style>

<body>

    <!-- Loading overlay -->
    <div id="loadingOverlay">
        <div class="spinner-border text-danger" role="status"></div>
        <p class="mt-3 fw-semibold">Creating listing, please wait...</p>
    </div>

    <!-- new listing form -->
    <div class="row">
        <div class="col-8 offset-2">
            <br>
            <h1>Create a new listing</h1>

            <form method="post"
                  action="/listings/add"
                  novalidate
                  class="needs-validation"
                  enctype="multipart/form-data"
                  id="newListingForm">

                <!-- TITLE -->
                <label class="form-label">Title</label>
                <input name="list[title]"
                       placeholder="Write title"
                       type="text"
                       class="form-control"
                       required>
                <small class="helper-text">
                    Example: <em>Cozy beach house near Goa</em>
                </small>
                <div class="invalid-feedback">Title is required</div>

                <br><br>

                <!-- DESCRIPTION -->
                <label class="form-label">Description</label>
                <textarea name="list[description]"
                          placeholder="Write description here"
                          class="form-control"
                          rows="4"
                          required></textarea>
                <small class="helper-text">
                    Example: Mention location, amenities, nearby attractions, and rules.
                </small>
                <div class="invalid-feedback">Description is required</div>

                <br><br>

                <!-- IMAGES -->
                <label class="form-label">Images  (At least 3 images and Maximum 10 images)</label>
                <input name="images[]"
                       type="file"
                       class="form-control"
                       accept="image/*"
                       multiple>
                <small class="helper-text">
                    Upload at least 3 clear images (bedroom, bathroom, outside view)
                </small>

                <br><br>

                <!-- PRICE / LOCATION / CATEGORY -->
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">Price</label>
                        <input name="list[price]"
                               placeholder="Enter price"
                               type="number"
                               min="0"
                               class="form-control"
                               required>
                        <small class="helper-text">
                            Price per night (₹).
                        </small>
                        <div class="invalid-feedback">Enter valid price</div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Location</label>
                        <input name="list[location]"
                               placeholder="City or Area"
                               type="text"
                               class="form-control"
                               required>
                        <small class="helper-text">
                            Example: <em>Baga Beach, Goa</em>
                        </small>
                        <div class="invalid-feedback">Enter valid location</div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Select Category</label>
                        <select class="form-select"
                                name="list[category_type]"
                                id="categorySelect">
                            <option selected value="rooms">Rooms</option>
                            <option value="airports">Airports</option>
                            <option value="apartment">Apartment</option>
                            <option value="beach">Beach</option>
                            <option value="boutique">Boutique</option>
                            <option value="bungalow">Bungalow</option>
                            <option value="budget">Budget</option>
                            <option value="camping">Camping</option>
                            <option value="castles">Castles</option>
                            <option value="cottage">Cottage</option>
                            <option value="desert">Desert</option>
                            <option value="farm">Farm</option>
                            <option value="forest">Forest</option>
                            <option value="hostel">Hostel</option>
                            <option value="hotel">Hotel</option>
                            <option value="house">House</option>
                            <option value="luxury">Luxury</option>
                            <option value="motel">Motel</option>
                            <option value="mountain">Mountain</option>
                            <option value="pools">Pools</option>
                            <option value="resort">Resort</option>
                            <option value="ship">Ship</option>
                            <option value="trending">Trending</option>
                            <option value="villa">Villa</option>
                        </select>
                        <small class="helper-text">
                            Choose the category that best matches your property.
                        </small>
                    </div>
                </div>

                <br>

                <!-- COUNTRY -->
                <label class="form-label">Country</label>
                <input name="list[country]"
                       placeholder="Country name"
                       type="text"
                       class="form-control"
                       required>
                <small class="helper-text">
                    Use full country name (e.g., India).
                </small>
                <div class="invalid-feedback">Enter valid country</div>

                <br>

                <button class="btn btn-dark">Add Listing</button>
            </form>
        </div>
    </div>
</body>
<script>
    // Bootstrap form validation
    (function () {
        'use strict'
        var forms = document.querySelectorAll('.needs-validation')
        Array.prototype.slice.call(forms)
            .forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
    })()


    /* ---------- Show loading overlay on submit ---------- */
    const newListingForm = document.getElementById('newListingForm');
    const overlay = document.getElementById('loadingOverlay');

    newListingForm.addEventListener('submit', () => {
        // If form is INVALID, do NOT show overlay
        if (!newListingForm.checkValidity()) {
            return;
        }
        // Form is valid → show overlay
        overlay.style.display = 'flex';
    });
</script>