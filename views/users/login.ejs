<%- layout('./layouts/boilerplate.ejs') %>

<style>
    /* ================= PASSWORD FIELD ================= */
    .password {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        position: relative;
    }

    .password i {
        cursor: pointer;
        position: absolute;
        right: 10px;
        color: #555;
    }

    .password input {
        width: 100%;
        padding-right: 30px;
    }

    /* ================= LOADING OVERLAY ================= */
    #loadingOverlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.9);
        z-index: 9999;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    }

</style>

<body>

    <!-- ================= LOADING OVERLAY ================= -->
    <div id="loadingOverlay">
        <div class="spinner-border text-danger" role="status"></div>
        <p class="mt-3 fw-semibold">Logging in, please wait...</p>
    </div>

    <!-- ================= LOGIN FORM ================= -->
    <div class="row">
        <div class="col-6 offset-3">
            <br>
            <h1>Login on Wanderlust</h1>

            <form method="POST"
                  action="/login"
                  novalidate
                  class="needs-validation"
                  id="loginForm">

                <!-- Username -->
                <label for="username" class="form-label">Username</label>
                <input
                    name="username"
                    type="text"
                    class="form-control"
                    required
                >
                <div class="invalid-feedback">
                    Username is required
                </div>

                <br>

                <!-- Password -->
                <label for="password" class="form-label">Password</label>
                <div class="password">
                    <input
                        name="password"
                        id="password"
                        type="password"
                        class="form-control"
                        required
                    >
                    <i class="fa-regular fa-eye" id="togglePassword"></i>
                </div>

                <div class="invalid-feedback">
                    Password is required
                </div>

                <br>

                <button class="btn btn-success" id="loginBtn">
                    Login
                </button>

            </form>
        </div>
    </div>
</body>

<script>
    // Bootstrap validation
    (() => {
        'use strict';
        const forms = document.querySelectorAll('.needs-validation');
        Array.from(forms).forEach(form => {
            form.addEventListener('submit', event => {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    })();

    /* ---------- Show loading overlay on submit ---------- */
    const loginForm = document.getElementById('loginForm');
    const overlay = document.getElementById('loadingOverlay');

    loginForm.addEventListener('submit', () => {
        // If form is INVALID, do NOT show overlay
        if (!loginForm.checkValidity()) {
            return;
        }
        // Form is valid â†’ show overlay
        overlay.style.display = 'flex';
    });
</script>
